<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~  Copyright (c) 2017, University of Dayton
  ~
  ~  Licensed under the Educational Community License, Version 2.0 (the "License");
  ~  you may not use this file except in compliance with the License.
  ~  You may obtain a copy of the License at
  ~
  ~              http://opensource.org/licenses/ecl2
  ~
  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
  -->
<beans xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:tx="http://www.springframework.org/schema/tx"
	   xmlns:context="http://www.springframework.org/schema/context"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xmlns="http://www.springframework.org/schema/beans"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

	<context:component-scan base-package="org.sakaiproject.attendance"/>
	<tx:annotation-driven transaction-manager="org.sakaiproject.springframework.orm.hibernate.GlobalTransactionManager"/>

	<!--  SakaiProxy -->
 	<bean id="org.sakaiproject.attendance.logic.SakaiProxy"
    	class="org.sakaiproject.attendance.impl.logic.SakaiProxyImpl"
        init-method="init">

        <!-- API injection -->
        <property name="securityService" ref="org.sakaiproject.authz.api.SecurityService" />
        <property name="sessionManager" ref="org.sakaiproject.tool.api.SessionManager" />
        <property name="toolManager" ref="org.sakaiproject.tool.api.ToolManager" />
        <property name="userDirectoryService" ref="org.sakaiproject.user.api.UserDirectoryService" />
		<property name="eventTrackingService" ref="org.sakaiproject.event.api.EventTrackingService" />
		<property name="serverConfigurationService" ref="org.sakaiproject.component.api.ServerConfigurationService" />
		<property name="siteService" ref="org.sakaiproject.site.api.SiteService" />
		<property name="preferencesService" ref="org.sakaiproject.user.api.PreferencesService" />
		<property name="authzGroupService" ref="org.sakaiproject.authz.api.AuthzGroupService" />

	</bean>

	<!-- AttendanceLogic -->
	<bean id="org.sakaiproject.attendance.logic.AttendanceLogic"
		  class="org.sakaiproject.attendance.impl.logic.AttendanceLogicImpl">

		<property name="attendanceEventRepository" ref="org.sakaiproject.attendance.api.repository.AttendanceEventRepository" />
		<property name="attendanceGradeRepository" ref="org.sakaiproject.attendance.api.repository.AttendanceGradeRepository" />
		<property name="attendanceRecordRepository" ref="org.sakaiproject.attendance.api.repository.AttendanceRecordRepository" />
		<property name="attendanceSiteRepository" ref="org.sakaiproject.attendance.api.repository.AttendanceSiteRepository" />
		<property name="attendanceStatusRepository" ref="org.sakaiproject.attendance.api.repository.AttendanceStatusRepository" />
		<property name="gradingRuleRepository" ref="org.sakaiproject.attendance.api.repository.GradingRuleRepository" />
		<property name="sakaiProxy" ref="org.sakaiproject.attendance.logic.SakaiProxy" />
		<property name="attendanceGradebookProvider" ref="org.sakaiproject.attendance.api.AttendanceGradebookProvider" />
	</bean>

	<!-- PDFEventExporter -->
	<bean id="org.sakaiproject.attendance.export.PDFEventExporter"
		  class="org.sakaiproject.attendance.impl.export.PDFEventExporterImpl"
		  init-method="init">

		<property name="attendanceLogic" ref="org.sakaiproject.attendance.logic.AttendanceLogic" />
		<property name="sakaiProxy" ref="org.sakaiproject.attendance.logic.SakaiProxy" />
		<property name="userTimeService" ref="org.sakaiproject.time.api.UserTimeService" />

	</bean>

	<!-- AttendanceGradebookProvider -->
	<bean id="org.sakaiproject.attendance.api.AttendanceGradebookProvider"
		  class="org.sakaiproject.attendance.impl.AttendanceGradebookProviderImpl"
		  init-method="init">

		<property name="attendanceLogic" ref="org.sakaiproject.attendance.logic.AttendanceLogic" />
		<property name="sakaiProxy" ref="org.sakaiproject.attendance.logic.SakaiProxy" />
		<property name="toolManager" ref="org.sakaiproject.tool.api.ToolManager" />
		<property name="gradingService" ref="org.sakaiproject.grading.api.GradingService" />
	</bean>

	<!--  Hibernate persistence -->

	<bean id="org.sakaiproject.springframework.orm.hibernate.impl.AdditionalHibernateMappings.attendance"
		  class="org.sakaiproject.springframework.orm.hibernate.impl.AdditionalHibernateMappingsImpl">
		<property name="annotatedClasses">
			<list>
				<value>org.sakaiproject.attendance.api.model.AttendanceEvent</value>
				<value>org.sakaiproject.attendance.api.model.AttendanceGrade</value>
				<value>org.sakaiproject.attendance.api.model.AttendanceRecord</value>
				<value>org.sakaiproject.attendance.api.model.AttendanceStatus</value>
				<value>org.sakaiproject.attendance.api.model.AttendanceSite</value>
				<value>org.sakaiproject.attendance.api.model.GradingRule</value>
			</list>
		</property>
	</bean>

	<bean id="org.sakaiproject.attendance.api.repository.AttendanceEventRepository"
		  class="org.sakaiproject.attendance.impl.repository.AttendanceEventRepositoryImpl">
		<property name="sessionFactory" ref="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory"/>
	</bean>

	<bean id="org.sakaiproject.attendance.api.repository.AttendanceGradeRepository"
		  class="org.sakaiproject.attendance.impl.repository.AttendanceGradeRepositoryImpl">
		<property name="sessionFactory" ref="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory"/>
	</bean>

	<bean id="org.sakaiproject.attendance.api.repository.AttendanceRecordRepository"
		  class="org.sakaiproject.attendance.impl.repository.AttendanceRecordRepositoryImpl">
		<property name="sessionFactory" ref="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory"/>
	</bean>

	<bean id="org.sakaiproject.attendance.api.repository.AttendanceSiteRepository"
		  class="org.sakaiproject.attendance.impl.repository.AttendanceSiteRepositoryImpl">
		<property name="sessionFactory" ref="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory"/>
	</bean>

	<bean id="org.sakaiproject.attendance.api.repository.AttendanceStatusRepository"
		  class="org.sakaiproject.attendance.impl.repository.AttendanceStatusRepositoryImpl">
		<property name="sessionFactory" ref="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory"/>
	</bean>

	<bean id="org.sakaiproject.attendance.api.repository.GradingRuleRepository"
		  class="org.sakaiproject.attendance.impl.repository.GradingRuleRepositoryImpl">
		<property name="sessionFactory" ref="org.sakaiproject.springframework.orm.hibernate.GlobalSessionFactory"/>
	</bean>
</beans>
